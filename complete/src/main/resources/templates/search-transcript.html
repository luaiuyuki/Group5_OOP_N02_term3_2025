<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Search Transcript by Semester</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #fff6fa;
      font-family: 'Segoe UI', sans-serif;
    }

    .search-container {
      max-width: 800px;
      margin: 40px auto;
    }

    .input-group {
      border-radius: 50px;
      overflow: hidden;
      border: 1px solid #f8d7e4;
      background-color: #fff0f5;
    }

    .input-group input {
      border: none;
      border-radius: 50px 0 0 50px;
      background-color: #fff0f5;
      color: #d63384;
      font-size: 16px;
      padding: 10px 20px;
    }

    .input-group button {
      background-color: #d63384;
      color: white;
      border-radius: 0 50px 50px 0;
      padding: 0 20px;
      font-size: 18px;
      border: none;
    }

    .input-group button:hover {
      background-color: #c8236f;
    }

    #transcriptResult th, #transcriptResult td {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      vertical-align: middle;
    }

    .text-center.mt-4 button {
      font-size: 16px;
    }
  </style>
</head>
<body>

<div class="search-container">
  <form onsubmit="searchSemester(event)" style="max-width: 600px; margin: 0 auto;">
    <div class="input-group shadow-sm">
      <input type="text" id="semesterInput" class="form-control" placeholder="Semester (e.g: HK1-2023)" required>
      <button type="submit">üîç</button>
    </div>
  </form>

  <div id="transcriptResult" class="mt-4">
    <!-- AJAX s·∫Ω load fragment transcript-result-semester.html ·ªü ƒë√¢y -->
  </div>
</div>

<script>
  function searchSemester(event) {
    event.preventDefault();
    const semester = document.getElementById("semesterInput").value;
    fetch(`/transcripts/search-by-semester?semester=${encodeURIComponent(semester)}`)
      .then(response => response.text())
      .then(html => {
        document.getElementById("transcriptResult").innerHTML = html;
        rebindSemesterAjax();
      })
      .catch(error => {
        console.error("L·ªói:", error);
        document.getElementById("transcriptResult").innerHTML =
          "<p class='text-danger'>ƒê√£ x·∫£y ra l·ªói ho·∫∑c kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.</p>";
      });
  }

  function rebindSemesterAjax() {
    document.querySelectorAll(".edit-btn").forEach(btn => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        fetch(this.href)
          .then(res => res.text())
          .then(html => {
            document.getElementById("transcriptResult").innerHTML = html;
            rebindSemesterAjax();
          });
      });
    });

    document.querySelectorAll(".delete-btn").forEach(btn => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        if (confirm("Delete this record?")) {
          fetch(this.href)
            .then(res => res.text())
            .then(html => {
              document.getElementById("transcriptResult").innerHTML = html;
              rebindSemesterAjax();
            });
        }
      });
    });

    const form = document.querySelector("#transcriptResult form.transcript-form");
    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch("/ajax-transcript/save", {
          method: "POST",
          body: formData
        })
          .then(res => res.text())
          .then(html => {
            document.getElementById("transcriptResult").innerHTML = html;
            rebindSemesterAjax();
          });
      });
    }
  }

  document.addEventListener("DOMContentLoaded", rebindSemesterAjax);
</script>

</body>
</html>
