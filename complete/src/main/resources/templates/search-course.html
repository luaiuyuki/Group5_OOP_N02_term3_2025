<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>🔎 Search Course Transcript</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #fff6fa;
      font-family: 'Segoe UI', sans-serif;
    }

    .search-container {
      max-width: 800px;
      margin: 40px auto;
      padding: 0;
    }

    #transcriptResult th,
    #transcriptResult td {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      vertical-align: middle;
    }

    #transcriptResult .card {
      border: 1px solid #f8d7e4;
      border-radius: 16px;
      background-color: #fff0f5;
    }

    #transcriptResult .card-header {
      background-color: #fde6ef;
      color: #d63384;
      font-weight: 600;
      font-size: 18px;
      border-radius: 16px 16px 0 0;
    }

    #transcriptResult .form-label {
      font-weight: 500;
      margin-bottom: 6px;
      color: #d63384;
    }

    #transcriptResult .form-control {
      border-radius: 10px;
      border: 1px solid #f3c1d5;
      background-color: #fff;
      font-size: 15px;
      padding: 10px 14px;
    }

    #transcriptResult .btn-primary,
    #transcriptResult .btn-pink {
      background-color: #d63384;
      color: white;
      border-radius: 50px;
      padding: 6px 24px;
      border: none;
    }

    #transcriptResult .btn-pink:hover {
      background-color: #c8236f;
    }

    #transcriptResult .row > div {
      padding-left: 12px;
      padding-right: 12px;
    }

    #transcriptResult .card-body {
      padding: 24px;
    }

    #transcriptResult .text-center.mt-4 button {
      font-size: 16px;
    }
  </style>
</head>
<body>

<div class="search-container">
  <form onsubmit="searchCourse(event)" style="max-width: 600px; margin: 0 auto;">
    <div class="input-group shadow-sm"
         style="border-radius: 50px; overflow: hidden;
                border: 1px solid #f8d7e4; background-color: #fff0f5;">
      <input type="text"
             id="courseIdInput"
             class="form-control border-0"
             placeholder="Course ID (e.g: C001)"
             style="border-radius: 50px 0 0 50px;
                    background-color: #fff0f5;
                    color: #d63384;
                    font-size: 16px;
                    padding: 10px 20px;"
             required>
      <button type="submit"
              class="btn text-white"
              style="background-color: #d63384;
                     border-radius: 0 50px 50px 0;
                     padding: 0 20px;
                     font-size: 18px;">
        🔍
      </button>
    </div>
  </form>

  <div id="transcriptResult" class="mt-4">
    <!-- Transcript table and form will be loaded here -->
  </div>
</div>

<script>
  function searchCourse(event) {
    event.preventDefault();
    const courseID = document.getElementById("courseIdInput").value;
    fetch(`/transcripts/search-by-course?courseID=${encodeURIComponent(courseID)}`)
      .then(response => response.text())
      .then(html => {
        document.getElementById("transcriptResult").innerHTML = html;
        rebindAjaxButtons();
      })
      .catch(error => {
        console.error("Error fetching transcript:", error);
        document.getElementById("transcriptResult").innerHTML =
          "<p class='text-danger'>An error occurred or no result found.</p>";
      });
  }

  function rebindAjaxButtons() {
    document.querySelectorAll(".edit-btn").forEach(btn => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        fetch(this.href)
          .then(res => res.text())
          .then(html => {
            document.getElementById("transcriptResult").innerHTML = html;
            rebindAjaxButtons();
          });
      });
    });

    document.querySelectorAll(".delete-btn").forEach(btn => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        if (confirm("Delete this record?")) {
          fetch(this.href)
            .then(res => res.text())
            .then(html => {
              document.getElementById("transcriptResult").innerHTML = html;
              rebindAjaxButtons();
            });
        }
      });
    });

    const form = document.querySelector("#transcriptResult form.transcript-form");
    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch(this.action, {
          method: "POST",
          body: formData
        })
          .then(res => res.text())
          .then(html => {
            document.getElementById("transcriptResult").innerHTML = html;
            rebindAjaxButtons();
          });
      });
    }
  }
</script>

</body>
</html>
